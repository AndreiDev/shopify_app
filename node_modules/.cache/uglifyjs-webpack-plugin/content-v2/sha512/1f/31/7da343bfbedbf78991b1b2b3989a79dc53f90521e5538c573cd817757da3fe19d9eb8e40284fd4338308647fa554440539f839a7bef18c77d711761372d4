{"code":"!function(e){var t={};function s(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var r in e)s.d(o,r,function(t){return e[t]}.bind(null,r));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,\"a\",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p=\"/var/folders/4d/x387y60x4_x43zkrtqvq2_8r0000gn/T/_karma_webpack_/\",s(s.s=0)}([function(e,t,s){\"use strict\";s.r(t);s(1),s(2);suite(\"StorageAccessHelper\",()=>{let e;const t={hasStorageAccessUrl:\"https://hasStorageAccess.com\",doesNotHaveStorageAccessUrl:\"https://doesNotHaveStorageAccess.com\",myShopifyUrl:\"https://shop1.myshopify.io\",home:\"https://app.io\"};let s,o;setup(()=>{window.parent.postMessage=sinon.stub(),s=document.createElement(\"div\"),o=document.createElement(\"button\"),s.setAttribute(\"id\",\"RequestStorageAccess\"),o.setAttribute(\"id\",\"TriggerAllowCookiesPrompt\"),o.setAttribute(\"type\",\"button\"),s.appendChild(o),document.body.appendChild(s),e=new StorageAccessHelper(t)}),teardown(()=>{document.body.removeChild(s)}),suite(\"execute\",()=>{test(\"calls redirectToAppHome instead of manageStorageAccess if UserAgentUtilities.shouldRenderITPContent returns false\",async()=>{sinon.stub(UserAgentUtilities.prototype,\"shouldRenderITPContent\").callsFake(()=>!1);const t=sinon.stub(e,\"manageStorageAccess\").callsFake(()=>!0),s=sinon.stub(e,\"redirectToAppHome\");e.execute(),sinon.assert.notCalled(t),sinon.assert.called(s),UserAgentUtilities.prototype.shouldRenderITPContent.restore(),t.restore(),s.restore()}),test(\"calls manageStorageAccess instead of redirectToAppHome if UserAgentUtilities.shouldRenderITPContent returns true\",async()=>{sinon.stub(UserAgentUtilities.prototype,\"shouldRenderITPContent\").callsFake(()=>!0);const t=sinon.stub(e,\"manageStorageAccess\").callsFake(()=>!0),s=sinon.stub(e,\"redirectToAppHome\");e.execute(),sinon.assert.called(t),sinon.assert.notCalled(s),UserAgentUtilities.prototype.shouldRenderITPContent.restore(),t.restore(),s.restore()})}),suite(\"manageStorageAccess\",()=>{test(\"calls handleHasStorageAccess instead of handleGetStorageAccess if document.hasStorageAccess returns true\",async()=>{document.hasStorageAccess=(()=>new Promise(e=>{e(!0)}));const t=sinon.stub(e,\"handleGetStorageAccess\"),s=sinon.stub(e,\"handleHasStorageAccess\");e.manageStorageAccess().then(()=>{sinon.assert.called(s),sinon.assert.notCalled(t),s.restore(),t.restore()})}),test(\"calls handleGetStorageAccess instead of handleHasStorageAccess if document.hasStorageAccess returns false\",async()=>{document.hasStorageAccess=(()=>new Promise(e=>{e(!1)}));const t=sinon.stub(e,\"handleGetStorageAccess\"),s=sinon.stub(e,\"handleHasStorageAccess\");e.manageStorageAccess().then(()=>{sinon.assert.called(t),sinon.assert.notCalled(s),s.restore(),t.restore()})})}),suite(\"handleGetStorageAccess\",()=>{test(\"calls setupRequestStorageAccess instead of redirectToAppTLD if shopify.has_redirected is defined in sessionStorage\",()=>{const t=sinon.stub(e,\"setupRequestStorageAccess\"),s=sinon.stub(e,\"redirectToAppTLD\");sessionStorage.setItem(\"shopify.has_redirected\",\"true\"),e.handleGetStorageAccess(),sinon.assert.called(t),sinon.assert.notCalled(s),t.restore(),s.restore()}),test(\"calls redirectToAppTLD instead of setupRequestStorageAccess if shopify.has_redirected is defined in sessionStorage\",()=>{const t=sinon.stub(e,\"setupRequestStorageAccess\"),s=sinon.stub(e,\"redirectToAppTLD\");sessionStorage.removeItem(\"shopify.has_redirected\"),e.handleGetStorageAccess(),sinon.assert.notCalled(t),sinon.assert.called(s),t.restore(),s.restore()})}),suite(\"handleHasStorageAccess\",()=>{test(\"calls redirectToAppHome instead of redirectToAppTLD if shopify.granted_storage_access is defined in sessionStorage\",()=>{const t=sinon.stub(e,\"redirectToAppHome\"),s=sinon.stub(e,\"redirectToAppTLD\");sessionStorage.setItem(\"shopify.granted_storage_access\",\"true\"),e.handleHasStorageAccess(),sinon.assert.called(t),sinon.assert.notCalled(s),t.restore(),s.restore()}),test(\"calls redirectToAppTLD instead of redirectToAppHome if shopify.granted_storage_access is defined in sessionStorage\",()=>{const t=sinon.stub(e,\"redirectToAppHome\"),s=sinon.stub(e,\"redirectToAppTLD\");sessionStorage.removeItem(\"shopify.granted_storage_access\"),e.handleHasStorageAccess(),sinon.assert.notCalled(t),sinon.assert.called(s),t.restore(),s.restore()})}),suite(\"setupRequestStorageAccess\",()=>{test(\"adds an event listener to the expected button that calls requestStorageAccess on click\",()=>{document.requestStorageAccess=(()=>new Promise(e=>{e(!0)}));const t=sinon.spy(e,\"handleRequestStorageAccess\");e.setupRequestStorageAccess(),(o=document.querySelector(\"#TriggerAllowCookiesPrompt\")).click(),sinon.assert.called(t),t.restore()}),test('sets display property of the expected node to \"block\"',()=>{e.setupRequestStorageAccess(),s=document.querySelector(\"#RequestStorageAccess\"),sinon.assert.match(s.style.display,\"block\")})}),suite(\"handleRequestStorageAccess\",()=>{test(\"calls redirectToAppHome instead of redirectToAppTLD when document.requestStorageAccess resolves\",()=>{document.requestStorageAccess=(()=>new Promise(e=>{e()}));const t=sinon.stub(e,\"redirectToAppHome\"),s=sinon.stub(e,\"redirectToAppTLD\");e.handleRequestStorageAccess().then(()=>{sinon.assert.called(redirectToAppHomeSpy),sinon.assert.notCalled(redirectToAppTLDSpy),t.restore(),s.restore()})}),test('calls redirectToAppTLD with \"access denied\" instead of calling redirectToAppHome when document.requestStorageAccess fails',()=>{document.requestStorageAccess=(()=>new Promise((e,t)=>{t()}));const t=sinon.stub(e,\"redirectToAppHome\"),s=sinon.stub(e,\"redirectToAppTLD\");e.handleRequestStorageAccess().then(()=>{sinon.assert.notCalled(redirectToAppHomeSpy),sinon.assert.calledWith(redirectToAppTLDSpy,\"access denied\"),t.restore(),s.restore()})})}),suite(\"redirectToAppHome\",()=>{test('sets \"shopify.granted_storage_access\" in sessionStorage',()=>{e.redirectToAppHome(),sinon.assert.match(sessionStorage.getItem(\"shopify.granted_storage_access\"),\"true\")})}),suite(\"redirectToAppTLD\",()=>{test('sets \"shopify.has_redirected\" in sessionStorage',()=>{e.redirectToAppTLD(),sinon.assert.match(sessionStorage.getItem(\"shopify.has_redirected\"),\"true\")})})})},function(e,t){},function(e,t){function s(e){this.redirectInfo=e}s.prototype.setNormalizedLink=function(e){return\"access granted\"===e?this.redirectInfo.hasStorageAccessUrl:this.redirectInfo.doesNotHaveStorageAccessUrl},s.prototype.redirectToAppTLD=function(e){var t=document.createElement(\"a\");t.href=this.setNormalizedLink(e),data=JSON.stringify({message:\"Shopify.API.remoteRedirect\",data:{location:t.href}}),window.parent.postMessage(data,this.redirectInfo.myshopifyUrl),sessionStorage.setItem(\"shopify.has_redirected\",\"true\")},s.prototype.redirectToAppHome=function(){sessionStorage.setItem(\"shopify.granted_storage_access\",\"true\"),window.location.href=this.redirectInfo.home},s.prototype.handleRequestStorageAccess=function(){return document.requestStorageAccess().then(this.redirectToAppHome.bind(this),this.redirectToAppTLD.bind(this,\"access denied\"))},s.prototype.setupRequestStorageAccess=function(){const e=document.querySelector(\"#RequestStorageAccess\");document.querySelector(\"#TriggerAllowCookiesPrompt\").addEventListener(\"click\",this.handleRequestStorageAccess.bind(this)),e.style.display=\"block\"},s.prototype.handleHasStorageAccess=function(){sessionStorage.getItem(\"shopify.granted_storage_access\")?this.redirectToAppHome():this.redirectToAppTLD(\"access granted\")},s.prototype.handleGetStorageAccess=function(){sessionStorage.getItem(\"shopify.has_redirected\")?this.setupRequestStorageAccess():this.redirectToAppTLD(\"access denied\")},s.prototype.manageStorageAccess=function(){return document.hasStorageAccess().then(function(e){e?this.handleHasStorageAccess():this.handleGetStorageAccess()}.bind(this))},s.prototype.execute=function(){(new UserAgentUtilities).shouldRenderITPContent()?this.manageStorageAccess():this.redirectToAppHome()}}]);","extractedComments":[]}